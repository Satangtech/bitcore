import { expect } from 'chai';
import { EvmDataStorage } from '../../../src/modules/firocoin/models/evmData';
import { resetDatabase } from '../../helpers';
import { intAfterHelper, intBeforeHelper } from '../../helpers/integration';

async function insertEvmData() {
  await EvmDataStorage.collection.insertOne({
    chain: 'FIRO',
    network: 'regtest',
    txid: '5e45c010b7d67b2db7da2a7a5669abc134aaf51748ce184a4db022d22ef51223',
    byteCode:
      '02000000120fa5d0991d86bed4ac6b6b9c204a0fbfccc636ec6d1da178d49e551832c5521b000000006a4730440220460a2a8890e80246751ab049db7487738fe663b2607f8ffbc7b619b0accdcdda0220739acbdb61a88e28298f601e5f92f9030ddfae6ed0598ca709e3335e51f323e4012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708feffffff32708384866fc91f2d9868bb5dd9b2a040bc912ad06ae2cc963ebe30350a6802000000006a473044022077fc2ed002de483f55d88c3777f5dd101f251d85209a9b3c7d1d89138cc970a602204656d1e844a5d26f5181839adf7bbe1378be67f4feee3cd33520fc0615c08c20012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708feffffff0fb27dea74569eeeddc30090d65742a60f150d289bf2f7549e17d6fcf045e958000000006a47304402207b9915a65998fbe3fd9c55d1c5cb850da1518bc4ffc812bcf6b0325aa9dd0f96022065404f9724bc8de6dd3395f5fe28f910e038a3a3b89a1f8b64f3f64cd5fcf5fe012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708feffffffbf346679d36366713e70fe427d3291146921d798ff86322043493d355da418e4000000006a473044022039eade518c4a134fbe4696083fbb948f3a22d938ce1b393c3292b16b98b9014f022033473a594cc38bb38d70012f8b2dac07d75f97de62329e59de4e91f5bc93c827012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708feffffff42b7d9aaf7fa1be724600eea8b670d4a2cf379f2a3c19fff9dcbceeb3ee8330e000000006a47304402200eff3d6f45db7edfe97f01c482f443e797e6417eae5fa2bb5cd15f7f9d542cf502203f569a8f0d3387d31285a89d8f67a60c4b82954e863682a97f4f9c23b784451a012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708feffffff5730375aac409c8dfb2c9a96e0e4ea9cebcab3ba239185c0b8b86c0047858df6000000006a473044022014bf0b8b0ed277414a28d02340c5d89aed22855e4d723bf712a921ce9d3c9da2022052e6aa2120ce8d61790aa1cbd8ee6f64ff6f0ed85c9429f68982ea8686a5761a012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708feffffffd8e1548671c5aa6ec3f46eec4662c26b122ee5883dcb7395ac0b977ae64093b4000000006a47304402200bd1d6966b1a775fd32ca43397877b3342180ed308a393967239d62f9cf9992f02207c8f72e07469163d55d6c9cb2b01f171b985427b6c35c645cddb92fa532d624b012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708feffffff7edd11f782d9e37c2c9703a65f4a3d238088c939ca474d987427436e7971c630000000006a47304402200d8576700ca3aea790b5765e6a66224b20b10526f0b96569aaa59620babe12a002204d0093a50c556eb37391d05cc21a1645adff83d3850236642ab9c57b6f84b3a3012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708feffffff60fa48f36a0d758a5e131658436e96ea8bbb08f1243db5dacd70b7c46c7f9671000000006a47304402202f42d73aa93610fdd53c875d0ee62f22667042a9ad8ec638beb725cc9a3506b50220324996e93c175cbf02381e77dd26b448b32dd0d287c764d4633972d5da160785012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708feffffff0ffd91c1a2b0e9278e9f274283a7c2ac131d3e03cc68c5cdbee6638b7affbec9000000006a47304402201705e90ee8a3cdfb3922f88537fe46898b9d7b8d6a87b4b2c6daddbd2afd2d9702201b457636284c6aecf0aa8c46b951d2f0718aaf800670f2cee2ada79da3a2c77f012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708feffffff8a364b6b5fa5e2b58bc1ad45ccda1a469a64a1e6b11f40dda99b780be5ac210f000000006a47304402204bc34cb290e9cf5487e251e234fa11a9dff211f22b808c73a1bdd29e7c78ee2302206dc86ed62f1c21391757b880c6dd59ad8d04963e91ae863a2b7dbc7f0053a86f012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708feffffffd28b6887a07d0cd7112e739be7de7697a49fdd81c28e3be03d19f2e1a1163fa1000000006a47304402205d6e142c8a0346f3db25e3fd70c8331b898edaa7690de8ee94f7ed3c0e09870902203d627ad941ba2bf7ea73dbe2e893091ed78cf3bf8ff93dc96765822ca13f8135012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708feffffffb5e80e9b1ac2940024914bff2cefc0f881d5a49f2f58c54e15fd3b6e3fb9514a000000006a473044022051883685aefd42101ec20b7b8a309e244486e491b6b62f146c8fb3a5bf39d2950220755ae731e35b035e0bd5706382d471ff50eeb35ca0adbdf68fd2d97f13c64b2e012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708feffffffbfc5d5294fa2e72e03f164b7c9228174be187f90745be137b8a9d241ed512ac3000000006a4730440220183410e050c360114ade16573b1955177fb186760d7af1c261bc92cf7cd7798702205e1588e92b50faae7b72e4959d1ae37351a75d67a8a1850daedea6c2fcf96b5b012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708feffffff3d7c7731913ec8df9c411c28861ca98704fef7a5821dc1719fae722a9df5d87a000000006a473044022034bb5571ffc8604b342f0978c23927eb32e15aed2f2f4ab9fff6166e17f886cb0220498fecc722e4ebe468b454e1c1cb5b58506c89d6aff9dab43643ed7e5258f4c2012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708feffffff29a62096a9480dd63ebe50cba7099c4506b7205375f2f95bbfdef26a135ea611000000006a47304402206214439ca690c3e3e2ac04e4a6ad1ddbc5454e7ed31d42879a8b1e6bd16bc75902207f6e8510bc5ef2000af31c9b17b5e8dfd3afa35923a604328185913dad4d4db8012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708fefffffffb564869fa275b5a4efeb8f2d8edcda5e756238466bfd7065617e001bec1d323000000006a4730440220468cb9abd3159fabe5988737e9840d1e3d613936560a347113e0dcb3a75bdc410220068be558916b0adec2b5f4f11a833087afbd5f6086732b53ce1bc9b7dc521e80012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708feffffff29661e7827f537df672c74e0d2e646c1cf8117e39685cc44d622fd58826e8c99000000006a4730440220102e7c84527b3c3e1548e94c7699cd1dad6c4047ae4d9e2f627ceaee3c7c04e7022023b8316393d66346cd03c062e984fa25e48ab90f1e8ce553938b216e1b1c045e012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708feffffff02181f0d20000000001976a914efac02fd1949372e85eaa910ea3100f6a5237b3088ac0000000000000000e9010114efac02fd1949372e85eaa910ea3100f6a5237b304c6b6a47304402200d86b98943a5e62fe8916f7e4eddb36074b4214c7744e13d516a4f0ba40bb63402206d31a12fd867bdc08fe26af4de08b4a83cbef611178f0837d8f65c553b6da152012102391d8de84ca6ceb79184a93a6e2d6efe718af5604d9707aeb8da492e26701708c401040499999919012844a9059cbb000000000000000000000000d70fcf2b7fd2aa68e0a97ecf38b6f4133d666132000000000000000000000000000000000000000000000000000000000000271014933e0722991578ec87bc6953c5101e05bbca00f2c2cb000000',
    callData:
      'a9059cbb000000000000000000000000d70fcf2b7fd2aa68e0a97ecf38b6f4133d6661320000000000000000000000000000000000000000000000000000000000002710',
    contract: '933e0722991578ec87bc6953c5101e05bbca00f2',
    fvmGasLimit: '429496729',
    fvmGasPrice: 40,
    op: 'OP_CALL',
    version: '4',
  });
}

describe('EvmData Model', function () {
  const suite = this;
  this.timeout(30000);
  before(intBeforeHelper);
  after(() => intAfterHelper(suite));

  beforeEach(async () => {
    await resetDatabase();
  });

  describe('addEvmData', () => {
    it('get evm data', async () => {
      await insertEvmData();
      const evmData = await EvmDataStorage.collection.find({ chain: 'FIRO', network: 'regtest' }).toArray();
      expect(evmData.length).to.equal(1);
      expect(evmData[0].txid).to.equal('5e45c010b7d67b2db7da2a7a5669abc134aaf51748ce184a4db022d22ef51223');
      expect(evmData[0].version).to.equal('4');
      expect(evmData[0].fvmGasLimit).to.equal('429496729');
      expect(evmData[0].fvmGasPrice).to.equal(40);
      expect(evmData[0].op).to.equal('OP_CALL');
    });
  });
});
